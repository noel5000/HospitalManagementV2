<div class="card m-3">
    <h5 class="card-header">{{'patientCheckups_menu' | translate}}</h5>
    <div class="card-body">
        <form [formGroup]="itemForm" (ngSubmit)="save()">
            <div class="form-row">
                <div class="form-group col-md-6 col-xs-12">
                    <label>{{'doctor_lbl' | translate}}</label>
                    <input type="text" formControlName="doctorName" 
                    disabled class="form-control" [ngClass]="{ 'is-invalid':form.doctorName && form.doctorName.errors }" />
                    <div *ngIf="form.doctorName && form.doctorName.errors" class="invalid-feedback">
                        <div *ngIf="form.doctorName && form.doctorName.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                </div>
                <div class="form-group col-md-6 col-xs-12">
                    <label>{{'name_lbl' | translate}}</label>
                    <input type="text" formControlName="patientName"  disabled class="form-control" [ngClass]="{ 'is-invalid': form.patientName.errors }" />
                    <div *ngIf="form.patientName.errors" class="invalid-feedback">
                        <div *ngIf="form.patientName.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                </div>

                <div class="form-group col-md-6 col-xs-12">
                    <label>{{'symptoms_lbl' | translate}}</label>
                    <textarea formControlName="symptoms" minlength="1" required class="form-control" [ngClass]="{ 'is-invalid': form.symptoms.errors }"></textarea>
                    <div *ngIf="form.symptoms.errors" class="invalid-feedback">
                        <div *ngIf="form.symptoms.required">{{'required_lbl' | translate}}</div>
                    </div>
                </div>

                <div class="form-group col-md-6 col-xs-12">
                    <label>{{'diagnoses_lbl' | translate}}</label>
                    <textarea formControlName="diagnoses" minlength="1" required class="form-control" [ngClass]="{ 'is-invalid': form.diagnoses.errors }"></textarea>
                    <div *ngIf="form.diagnoses.errors" class="invalid-feedback">
                        <div *ngIf="form.diagnoses.required">{{'required_lbl' | translate}}</div>
                    </div>
                </div>

           </div>


           <div class="my-3">
            <h3 class="text-center">{{'attachments_lbl' | translate}}</h3>
               <div class="row my-1">
                <div class="col-md-6 col-xs-12">
                    <img src="../../../../assets/images/upload-solid.svg" style="height: 131px;" (click)="uploadClick()" class="btn-block">
                   <input type="file" id="imageUpload"  style="display: none" (onFileSelected)="fileSelectedUpload($event)"  name="imageUpload" ng2FileSelect [uploader]="uploader" />
                  </div>

                  <table class="col-md-6 col-xs-12 table">
                      <thead>
                         
                         
                      </thead>
                      <tbody>
                        <tr *ngFor="let attachment of attachments; let i=index">
                          <td><a  [href]="setLink(attachment)" target="_blank">{{attachment.fileAttachment.fileName}}</a></td>
                          <td><button type="button" (click)="removeAttachment(attachment.id)"  *ngIf="!(!editing || editing<1)" class="btn btn-danger">{{'delete_btn' | translate}}</button></td>
                        </tr>
                    </tbody>
                  </table>
               
            </div>
           </div>

           <div class="row">
            <nb-accordion style="width: 100%;" class="my-2">
                <nb-accordion-item>
                 <nb-accordion-item-header>{{'medicine_lbl' | translate}}</nb-accordion-item-header>
                 <nb-accordion-item-body>
                
            <div class="row">
                <div class="col-md-4 col-xs-12 row" *ngIf="!newProduct">
                    <div class="form-group col-10" >
                        <label>{{'medication_lbl' | translate}}</label>
                        <select class="form-control"
                        [ngClass]="{ 'is-invalid': form.productId.errors }"
                        formControlName="productId"
                        >
                        <option *ngFor="let medicine of medicines"
                         [value]="medicine.id"
                         >{{medicine.name}}</option>
                        </select>
                        <div *ngIf="form.productId.errors" class="invalid-feedback">
                            <div *ngIf="form.productId.errors.required">{{'required_lbl' | translate}}</div>
                        </div>
                    </div>
                    <div class="col-2 my-2" style="margin-left:-5%;">
                        <i class="btn btn-success btn-sm my-4 buttonCurson" *ngIf="!(!editing || editing<1)" (click)="addProduct('M')">+</i>
                    </div>
                </div>

                    

                <div class="col-md-4 col-xs-12 row" *ngIf="newProduct">
                    <div class="form-group col-10" >
                        <label >{{'medication_lbl' | translate}}</label>
                        <input type="text" formControlName="newProduct" minlength="1" maxlength="100"  
                     class="form-control" [ngClass]="{ 'is-invalid': form.newProduct && form.newProduct.errors }" />
                    <div *ngIf="form.newProduct && form.newProduct.errors" class="invalid-feedback">
                        <div *ngIf="form.newProduct && form.newProduct.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                    </div>
                    <div class="col-2 my-2" style="margin-left:-5%;">
                        <i class="btn btn-info btn-sm my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="saveNewProduct('M')">{{'add_btn' | translate}}</i>
                        <i class="btn btn-danger btn-sm my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="cancelNewProduct()">{{'cancel_btn' | translate}}</i>
                    </div>
                </div>
               
              
                <div class="form-group col-md-4 col-xs-12" >
                    <label>{{'daysAmount_lbl' | translate}}</label>
                    <input type="number" formControlName="quantity" min="1"  
                     class="form-control" [ngClass]="{ 'is-invalid': form.quantity.errors }" />
                    <div *ngIf="form.quantity.errors" class="invalid-feedback">
                        <div *ngIf="form.quantity.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                </div>
                <div class="form-group col-md-4 col-xs-12" >
                    <label>{{'whenToTake_lbl' | translate}}</label>
                    <select class="form-control"
                    [ngClass]="{ 'is-invalid': form.whenToTake.errors }"
                    formControlName="whenToTake"
                    >
                    <option *ngFor="let whentoTakeSelection of whentoTakeSelections"
                     [value]="whentoTakeSelection.key"
                     >{{whentoTakeSelection.value}}</option>
                    </select>
                    <div *ngIf="form.whenToTake.errors" class="invalid-feedback">
                        <div *ngIf="form.whenToTake.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                </div>
                <div class="form-check col-md-4  col-xs-12 my-4" >
                    <input class="form-check-input" type="checkbox"  formControlName="emptyStomach"   >
                    <label class="form-check-label" for="defaultCheck2">
                        {{'emptyStomach_lbl' | translate}}
                    </label>
                  </div>
                  <div class="form-group col-md-6 col-xs-12">
                    <label>{{'additionalInfo_lbl' | translate}}</label>
                    <input type="text" formControlName="additionalData" maxlength="500" 
                     class="form-control" />
                </div>
                <div class="col-md-3 col-xs-12">
                    <i class="btn btn-primary mr-1  my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="addPrescription('M')">{{'addMedicine_btn' | translate}}</i>
                </div>
            </div>
            <div class="scrollTableMobile" *ngIf="selectedMedicines.length>0">
                <h4>{{'medications_lbl' | translate}}</h4>
                <table class="table" >
                    <thead>
                        <tr>
                            <th>{{'name_lbl' | translate}}</th>
                            <th>{{'daysAmount_lbl' | translate}}</th>
                            <th>{{'quantity_lbl' | translate}}</th>
                            <th>{{'whenToTake_lbl' | translate}}</th>
                            <th>{{'emptyStomach_lbl' | translate}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let selectedMedicine of selectedMedicines; let i=index">
                            <td>{{selectedMedicine.product.name}}</td>
                            <td>{{selectedMedicine.quantity}}</td>
                            <td>{{selectedMedicine.medicinesAmount}}</td>
                            <td>{{selectedMedicine.whenToTake | translate}}</td>
                            <td>{{selectedMedicine.emptyStomach?('yes_lbl' | translate):('no_lbl' | translate)}}</td>
                            <td><i class="btn btn-danger"  *ngIf="!(!editing || editing<1)" (click)="deleteSelectedMedicine(i)">{{'delete_btn' | translate}}</i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
                 </nb-accordion-item-body>
                </nb-accordion-item>
                <nb-accordion-item>
                    <nb-accordion-item-header>{{'consultation_lbl' | translate}}</nb-accordion-item-header>
                    <nb-accordion-item-body>
                     
            <div class="row">
                  

                <div class="form-group col-md-4 col-xs-12 row" *ngIf="!newProduct">
                   <div class="form-group col-10">
                    <label>{{'medicalSpecialities_menu' | translate}}</label>
                    <select class="form-control"
                    [ngClass]="{ 'is-invalid': form.medicalSpecialityId.errors }"
                    formControlName="medicalSpecialityId"
                    >
                    <option *ngFor="let medicalSpeciality of medicalSpecialities"
                     [value]="medicalSpeciality.id"
                     >{{medicalSpeciality.name}}</option>
                    </select>
                    <div *ngIf="form.medicalSpecialityId.errors" class="invalid-feedback">
                        <div *ngIf="form.medicalSpecialityId.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                   </div>
                    <div class="col-2 my-2" style="margin-left:-5%;">
                        <i class="btn btn-success btn-sm my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="addProduct('C')">+</i>
                    </div>
                </div>
              

                <div class="col-md-4 col-xs-12 row" *ngIf="newProduct">
                    <div class="form-group col-10" >
                        <label>{{'medicalSpecialities_menu' | translate}}</label>
                        <input type="text" formControlName="newProduct" minlength="1" maxlength="100"  
                     class="form-control" [ngClass]="{ 'is-invalid': form.newProduct && form.newProduct.errors }" />
                    <div *ngIf="form.newProduct && form.newProduct.errors" class="invalid-feedback">
                        <div *ngIf="form.newProduct && form.newProduct.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                    </div>
                    <div class="col-2 my-2" style="margin-left:-5%;"  *ngIf="!(!editing || editing<1)">
                        <i class="btn btn-info btn-sm my-4 buttonCurson"  (click)="saveNewProduct('C')">{{'add_btn' | translate}}</i>
                        <i class="btn btn-danger btn-sm my-4 buttonCurson" (click)="cancelNewProduct()">{{'cancel_btn' | translate}}</i>
                    </div>
                </div>
               
              
            
                  <div class="form-group col-md-6 col-xs-12">
                    <label>{{'additionalInfo_lbl' | translate}}</label>
                    <input type="text" formControlName="additionalData" maxlength="500" 
                     class="form-control" />
                </div>
                <div class="col-md-3 col-xs-12">
                    <i class="btn btn-primary mr-1  my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="addPrescription('C')">{{'add_btn' | translate}}</i>
                </div>
            </div>
            <div class="scrollTableMobile" *ngIf="selectedConsultations.length>0">
                <h4>{{'consultations_lbl' | translate}}</h4>
                <table class="table" >
                    <thead>
                        <tr>
                            <th>{{'name_lbl' | translate}}</th>
                            <th>{{'additionalInfo_lbl' | translate}}</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let selectedConsultation of selectedConsultations; let i=index">
                            <td>{{selectedConsultation.medicalSpeciality.name}}</td>
                            <td>{{selectedConsultation.additionalData}}</td>
                            <td><i class="btn btn-danger"  *ngIf="!(!editing || editing<1)" (click)="deleteSelectedConsultation(i)">{{'delete_btn' | translate}}</i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
                    </nb-accordion-item-body>
                   </nb-accordion-item>
                   <nb-accordion-item>
                    <nb-accordion-item-header>{{'laboratory_lbl' | translate}}</nb-accordion-item-header>
                    <nb-accordion-item-body>
                     <div>
                        <div class="col-md-12 col-xs-12 row">
                            <div class="form-group col-9" >
                                <label >{{'laboratory_lbl' | translate}}</label>
                                <input type="text" formControlName="newProduct" maxlength="100"  
                             class="form-control" />
                            </div>
                            <div class="col-3 my-2" >
                                <i class="btn btn-info btn-sm my-4 mx-2 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="saveNewProduct('L')">{{'add_btn' | translate}}</i>
                                <i class="btn btn-danger btn-sm my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="cancelNewProduct()">{{'cancel_btn' | translate}}</i>
                            </div>
                        </div>
                        <div class="scrollTableMobile" id="labTestSelection">
           
                            <div>
                                <div class="row">
                                    <div class="col-6">
                                        <h4>{{'labTests_lbl' | translate}}</h4> 
                                    </div>
                                    
                                      <div class="col-2" style="margin-left:-5%;">
                                        <i class="btn btn-success btn-sm buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="addProduct()">+</i>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 col-xs-6"  *ngFor="let selectedLabTest of products; let i=index">
                                        <div *ngIf="selectedLabTest.id">
                                            <label for="vehicle1">{{selectedLabTest.name}}</label><br>
                                            <input type="checkbox"  [checked]="selectedLabTest.selected"  (click)="labTestSelection(i)">
                                        </div>
                                      
                                    </div>
                                </div>  
                            </div>
                            
                           
                        </div>

                        
        <div class="scrollTableMobile" id="selectedLabTestTable" *ngIf="selectedLabTests.length>0">
            <h4>{{'selectedlabTests_lbl' | translate}}</h4>
            <table class="table" >
                <thead>
                    <tr>
                        <th>{{'name_lbl' | translate}}</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let selectedLabTest of selectedLabTests; let i=index">
                        <td>{{selectedLabTest.product.name}}</td>
                        <td><i class="btn btn-danger"  *ngIf="!(!editing || editing<1)" (click)="deleteSelectedLabTests(i)">{{'delete_btn' | translate}}</i></td>
                    </tr>
                </tbody>
            </table>
        </div>
                      
                     </div>
                    </nb-accordion-item-body>
                   </nb-accordion-item>
                <nb-accordion-item>
                    <nb-accordion-item-header>{{'especializedImages_lbl' | translate}}</nb-accordion-item-header>
                    <nb-accordion-item-body>
                     
            <div class="row">
                <div class="col-md-4 col-xs-12 row" *ngIf="!newProduct">
                    <div class="form-group col-10" >
                        <label>{{'especializedImages_lbl' | translate}}</label>
                        <select class="form-control"
                        [ngClass]="{ 'is-invalid': form.productId.errors }"
                        formControlName="productId"
                        >
                        <option *ngFor="let medicine of specilizedimages"
                         [value]="medicine.id"
                         >{{medicine.name}}</option>
                        </select>
                        <div *ngIf="form.productId.errors" class="invalid-feedback">
                            <div *ngIf="form.productId.errors.required">{{'required_lbl' | translate}}</div>
                        </div>
                    </div>
                    <div class="col-2 my-2" style="margin-left:-5%;">
                        <i class="btn btn-success btn-sm my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="addProduct('E')">+</i>
                    </div>
                </div>

               
             
              

                <div class="col-md-4 col-xs-12 row" *ngIf="newProduct">
                    <div class="form-group col-10" >
                        <label >{{'especializedImages_lbl' | translate}}</label>
                        <input type="text" formControlName="newProduct" minlength="1" maxlength="100"  
                     class="form-control" [ngClass]="{ 'is-invalid': form.newProduct && form.newProduct.errors }" />
                    <div *ngIf="form.newProduct && form.newProduct.errors" class="invalid-feedback">
                        <div *ngIf="form.newProduct && form.newProduct.errors.required">{{'required_lbl' | translate}}</div>
                    </div>
                    </div>
                    <div class="col-2 my-2" style="margin-left:-5%;"  *ngIf="!(!editing || editing<1)">
                        <i class="btn btn-info btn-sm my-4 buttonCurson" (click)="saveNewProduct('E')">{{'add_btn' | translate}}</i>
                        <i class="btn btn-danger btn-sm my-4 buttonCurson" (click)="cancelNewProduct()">{{'cancel_btn' | translate}}</i>
                    </div>
                </div>
               
              
                
                  <div class="form-group col-md-6 col-xs-12">
                    <label>{{'additionalInfo_lbl' | translate}}</label>
                    <input type="text" formControlName="additionalData" maxlength="500" 
                     class="form-control" />
                </div>
                <div class="col-md-3 col-xs-12">
                    <i class="btn btn-primary mr-1  my-4 buttonCurson"  *ngIf="!(!editing || editing<1)" (click)="addPrescription('E')">{{'add_btn' | translate}}</i>
                </div>
            </div>
            
        <div class="scrollTableMobile" *ngIf="selectedImages.length>0">
            <h4>{{'especializedImages_lbl' | translate}}</h4>
            <table class="table" >
                <thead>
                    <tr>
                        <th>{{'name_lbl' | translate}}</th>
                        <th>{{'additionalInfo_lbl' | translate}}</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let selectedImage of selectedImages; let i=index">
                        <td>{{selectedImage.product.name}}</td>
                        <td>{{selectedImage.additionalData}}</td>
                        <td><i class="btn btn-danger"  *ngIf="!(!editing || editing<1)" (click)="deleteSelectedImage(i)">{{'delete_btn' | translate}}</i></td>
                    </tr>
                </tbody>
            </table>
        </div>
                    </nb-accordion-item-body>
                   </nb-accordion-item>
               </nb-accordion>
           </div>
         
       
           
       
       

       
       

           <br>
            
            <div class="text-center">
                <button *ngIf="this.permits.add || this.permits.update" [disabled]="!editing || editing<1" class="btn btn-primary mr-1">{{'save_btn' | translate}}</button>
                <button class="btn btn-secondary" type="reset" (click)="cancel()">{{'cancel_btn' | translate}}</button>
            </div>
        </form>
    </div>
</div>